'use strict';const a4_0x197750=a4_0x32f1;(function(_0x58e3f6,_0x27d1a8){const _0x324159=a4_0x32f1,_0x492518=_0x58e3f6();while(!![]){try{const _0x316103=parseInt(_0x324159(0x21a))/0x1*(parseInt(_0x324159(0x16a))/0x2)+-parseInt(_0x324159(0x220))/0x3+parseInt(_0x324159(0x21d))/0x4+parseInt(_0x324159(0x18a))/0x5*(parseInt(_0x324159(0x197))/0x6)+parseInt(_0x324159(0x1f5))/0x7*(parseInt(_0x324159(0x18d))/0x8)+-parseInt(_0x324159(0x1a2))/0x9*(parseInt(_0x324159(0x1fe))/0xa)+-parseInt(_0x324159(0x236))/0xb*(parseInt(_0x324159(0x119))/0xc);if(_0x316103===_0x27d1a8)break;else _0x492518['push'](_0x492518['shift']());}catch(_0x1c8e5b){_0x492518['push'](_0x492518['shift']());}}}(a4_0x3e0d,0x7a6d4));function a4_0x3e0d(){const _0x4f97db=['\x20must\x20not\x20be\x20empty','checkout','enumerable','failedTasks','\x20to\x20','Dependency\x20Graph:','Retrieved\x20credential\x20for\x20workspace\x20','debug','\x20has\x20expired','Reset\x20session\x20state\x20for\x20workspace\x20','text','utf-8','retryCount',')\x20exceeded\x20for\x20workspace\x20','claude','Failed\x20to\x20call\x20PR\x20creation\x20endpoint:\x20','other','Failed\x20to\x20get\x20credentials:\x20','toString','Mark\x20ready\x20endpoint\x20returned\x20','validation','\x20PR(s)\x20ready','PR\x20created\x20successfully:\x20','git\x20remote\x20get-url\x20origin','Marking\x20session\x20PRs\x20ready\x20from:\x20','\x20to\x20origin','.git','Unable\x20to\x20parse\x20remote\x20origin\x20URL:\x20','reset','hasOwnProperty',']\x20stderr:\x20','Failed\x20to\x20mark\x20PRs\x20ready:\x20','parse','map','title','.claude','failureClassification','Repository\x20','\x20contains\x20invalid\x20characters','process','Credentials\x20endpoint\x20returned\x20','Max\x20retries\x20(','abort','Using\x20--continue\x20for\x20workspace\x20','Executing\x20task\x20in\x20','GET','aiFix','\x20failed\x20tasks:\x20','\x20\x20Branch:\x20',',\x20got\x20','draft','Authentication\x20error:\x20','Credential\x20for\x20workspace\x20','filter','workspaces','now','\x20not\x20found\x20in\x20session','prototype','No\x20credential\x20found\x20for\x20workspace\x20','\x20in\x20','repos','Failed\x20to\x20call\x20credentials\x20endpoint:\x20','Get\x20session\x20endpoint\x20returned\x20','bun.lockb','edges','Marked\x20','70auYOTi','execSync','workspaceId','git','SIGTERM','join','dependencyGraph','Failed\x20to\x20fetch\x20session:\x20','running','96670tJDdxU','pending','clones','No\x20commits\x20ahead\x20of\x20base\x20branch','Failed\x20to\x20fetch\x20credentials:\x20','ciStatus','polygraphSessionUrl','Error:\x20','\x20at\x20','error','Retrieved\x20','signal','HEAD:refs/heads/','trim','split','maxRetries','Base\x20branch','@github.com/','branch','execFileSync','credentials','slice','existsSync','No\x20repo\x20registry\x20found\x20for\x20session\x20','POST','name','runs','URL:\x20','9925bmYlOb','\x20\x20AI\x20Fix:\x20','Creating\x20PR\x20via\x20nx-api:\x20','1165996QpNqby','pull','\x0astderr:\x20','1085292UyHWDf','exports','killAll','repositoryFullName','kill','...','initiator','\x20\x20URL:\x20','substring','--dangerously-skip-permissions','pullRequests','__esModule','--system-prompt','git\x20rev-parse\x20--git-dir','results','Polygraph\x20init-session\x20response:\x20','No\x20commits\x20ahead\x20of\x20base\x20branch\x20--\x20nothing\x20to\x20push','suggestedFixStatus','includes','pop','.nx','push','121aXMlLn','\x0a\x0aPartial\x20output:\x0a','Starting\x20new\x20session\x20for\x20workspace\x20','log','Failed\x20to\x20clone\x20repositories:\x20','prNumber','length','.gitignore','source','Remote\x20origin\x20URL\x20does\x20not\x20match\x20expected\x20repo\x20',']\x20Task\x20timed\x20out\x20after\x20','Resetting\x20clone\x20at\x20','Failed\x20to\x20install\x20dependencies\x20with\x20','909396kzwarC','Session:\x20','ciPipelineExecution','main','--force-with-lease','repo',']\x20Spawn\x20error:\x20','readFileSync','Successfully\x20pushed\x20','Installing\x20dependencies\x20with\x20','\x20workspace(s)\x20and\x20','Directory\x20','hasExistingSession','Failed\x20to\x20initialize\x20Polygraph\x20session:\x20','set','Failed\x20to\x20call\x20get\x20session\x20endpoint:\x20','getOwnPropertyNames','sessionId','isHealthy','url','path','/credentials','\x20seconds','test','owner','getStatus','clone','expiresAt','Retrieved\x20session\x20with\x20','pnpm','--print','Found\x20repo\x20for\x20','--depth','shortLink','dirname','Failed\x20to\x20call\x20mark\x20ready\x20endpoint:\x20','\x0a\x0aUse\x20cloud_polygraph_delegate\x20to\x20execute\x20tasks\x20across\x20these\x20repositories.','..HEAD','.nx/polygraph','writeFileSync','\x22\x20not\x20found\x20in\x20session\x20','Cloning\x20','stringify','/nx-cloud/polygraph/init-session','workspacePath','target','Request\x20headers:\x20','success','replace','https://x-access-token:','\x20PR(s)','nxCloudUrl','Fetching\x20session\x20from:\x20','Request\x20body:\x20','PR\x20creation\x20request\x20failed:\x20','clean','env','Failed\x20to\x20get\x20remote\x20URL:\x20','find','Status:\x20','close','headBranch','get','--hard','baseBranch','pnpm-lock.yaml','Failed\x20to\x20check\x20commits\x20ahead:\x20','values','Dependencies\x20installed\x20successfully','localPath','completed',']\x20Claude\x20exited\x20with\x20code\x20','output','.\x20Run\x20cloud_polygraph_init\x20first.','message','startsWith','some','\x0a\x0aTask:\x20','nodes','yarn','PR\x20creation\x20endpoint\x20returned\x20','122aQalxz','status','getOwnPropertyDescriptor','repoPath','agents','Context:\x20','.\x0aAvailable\x20repositories:\x20','Making\x20polygraph\x20init-session\x20request\x20to:\x20','Delegating\x20task\x20to\x20','Pushing\x20','number','activeCount','call','CI:\x20','tmpdir','active','stderr','data','\x20\x20CI:\x20No\x20pipeline\x20execution\x20found','\x20not\x20found\x20in\x20repo\x20registry','defaultBranch','No\x20Polygraph\x20session\x20found\x20with\x20ID:\x20','taskTimeout','bun','stdin','.nx/polygraph/\x0a','npm','stdout','logger','failed','end','origin','115365AcWCJF','\x20->\x20','\x20install','172488KqdStk','Pull\x20Requests:','Killing\x20process\x20for\x20workspace\x20','settings.json','npm\x20install','/prs/create','authHeaders','/nx-cloud/polygraph/session/','Killing\x20all\x20child\x20agent\x20processes','vcsConfiguration','162PVlYnI','prs','pipe','mkdirSync','\x20(workspace:\x20','\x20commit(s)\x20ahead\x20of\x20','endsWith','Failed\x20to\x20reset\x20clone\x20at\x20','SIGINT','child_process','match','36xtYCLB','#\x20Polygraph\x20Child\x20Agent\x0a\x0aYou\x20are\x20operating\x20as\x20a\x20child\x20agent\x20in\x20a\x20Polygraph\x20multi-repository\x20coordination\x20session.\x0a\x0a##\x20Guidelines\x0a\x0a-\x20Focus\x20on\x20the\x20specific\x20task\x20delegated\x20to\x20you\x20by\x20the\x20parent\x20agent\x0a-\x20Make\x20changes\x20only\x20within\x20this\x20repository\x0a-\x20Provide\x20clear,\x20concise\x20status\x20updates\x20about\x20your\x20progress\x0a-\x20If\x20you\x20encounter\x20blocking\x20issues,\x20report\x20them\x20clearly\x20so\x20the\x20parent\x20agent\x20can\x20assist\x0a\x0a##\x20Context\x0a\x0aThis\x20skill\x20is\x20automatically\x20injected\x20when\x20this\x20repository\x20is\x20being\x20coordinated\x20as\x20part\x20of\x20a\x20larger\x20Polygraph\x20session.\x20The\x20parent\x20agent\x20will\x20provide\x20specific\x20instructions\x20for\x20the\x20task\x20at\x20hand.\x0a','Branch\x20name','token','Checking\x20commits\x20ahead\x20of\x20','application/json','\x0a.nx/polygraph/\x0a','Task\x20failed:\x20','Network\x20error:\x20','repoFullName','spawn','Push\x20failed:\x20','session.json','.nx/polygraph/','toLowerCase','Failed\x20to\x20clone\x20','prUrls'];a4_0x3e0d=function(){return _0x4f97db;};return a4_0x3e0d();}var __defProp=Object['defineProperty'],__getOwnPropDesc=Object[a4_0x197750(0x16c)],__getOwnPropNames=Object[a4_0x197750(0x129)],__hasOwnProp=Object[a4_0x197750(0x1ec)][a4_0x197750(0x1d0)],__export=(_0x2e4506,_0x405a1e)=>{for(var _0x2b7504 in _0x405a1e)__defProp(_0x2e4506,_0x2b7504,{'get':_0x405a1e[_0x2b7504],'enumerable':!![]});},__copyProps=(_0x171c91,_0x2117d2,_0x5de4fc,_0x1733a5)=>{const _0x5b3edc=a4_0x197750;if(_0x2117d2&&typeof _0x2117d2==='object'||typeof _0x2117d2==='function'){for(let _0x1a8528 of __getOwnPropNames(_0x2117d2))if(!__hasOwnProp[_0x5b3edc(0x176)](_0x171c91,_0x1a8528)&&_0x1a8528!==_0x5de4fc)__defProp(_0x171c91,_0x1a8528,{'get':()=>_0x2117d2[_0x1a8528],'enumerable':!(_0x1733a5=__getOwnPropDesc(_0x2117d2,_0x1a8528))||_0x1733a5[_0x5b3edc(0x1b5)]});}return _0x171c91;},__toCommonJS=_0x1e7090=>__copyProps(__defProp({},a4_0x197750(0x22b),{'value':!![]}),_0x1e7090),polygraph_handlers_exports={};__export(polygraph_handlers_exports,{'formatPolygraphSession':()=>formatPolygraphSession,'polygraphCreatePRs':()=>polygraphCreatePRs,'polygraphDelegate':()=>polygraphDelegate,'polygraphGetSession':()=>polygraphGetSession,'polygraphInit':()=>polygraphInit,'polygraphMarkReady':()=>polygraphMarkReady,'polygraphPushBranch':()=>polygraphPushBranch}),module[a4_0x197750(0x221)]=__toCommonJS(polygraph_handlers_exports);var import_child_process=require('child_process'),POLYGRAPH_FETCH_TIMEOUT_MS=0x186a0;function sanitizeError(_0x25a077){const _0x39ad2b=a4_0x197750;return _0x25a077[_0x39ad2b(0x149)](/x-access-token:[^@]+@/g,'x-access-token:***@');}function validateGitRef(_0x881b6,_0xe1aaeb){const _0x118e57=a4_0x197750;if(!_0x881b6||_0x881b6[_0x118e57(0x20b)]()[_0x118e57(0x23c)]===0x0)return _0xe1aaeb+_0x118e57(0x1b3);if(/[;&|`$(){}[\]!#~<>\\'"\s\x00-\x1f\x7f]/[_0x118e57(0x130)](_0x881b6))return _0xe1aaeb+_0x118e57(0x1d9);if(_0x881b6[_0x118e57(0x232)]('..')||_0x881b6[_0x118e57(0x164)]('-')||_0x881b6['startsWith']('.'))return _0xe1aaeb+'\x20contains\x20invalid\x20git\x20ref\x20pattern';return null;}function execGitWithToken(_0xa4a7da,_0x3241e7){const _0x3bd733=a4_0x197750;(0x0,import_child_process[_0x3bd733(0x211)])(_0x3bd733(0x1f8),_0xa4a7da,{'cwd':_0x3241e7==null?void 0x0:_0x3241e7['cwd'],'stdio':_0x3bd733(0x199),'env':{...process[_0x3bd733(0x151)],'GIT_TERMINAL_PROMPT':'0'}});}async function createPolygraphPR(_0x224cee,_0xb4dbb7){const _0x560fca=a4_0x197750;var _0x44a752;const _0x59fc7b=_0xb4dbb7[_0x560fca(0x14c)]+_0x560fca(0x194)+_0xb4dbb7[_0x560fca(0x12a)]+_0x560fca(0x192),_0x22278e={'Content-Type':_0x560fca(0x1a7),..._0xb4dbb7[_0x560fca(0x193)]},_0x5c72bc=JSON[_0x560fca(0x143)]({'title':_0xb4dbb7['title'],'body':_0xb4dbb7['body']||null,'headBranch':_0xb4dbb7[_0x560fca(0x156)],'baseBranch':_0xb4dbb7[_0x560fca(0x159)]||null,'draft':_0xb4dbb7[_0x560fca(0x1e5)]??!![],'workspaceId':_0xb4dbb7[_0x560fca(0x1f7)]});_0x224cee[_0x560fca(0x239)](_0x560fca(0x21c)+_0x59fc7b),(_0x44a752=_0x224cee[_0x560fca(0x1ba)])==null?void 0x0:_0x44a752[_0x560fca(0x176)](_0x224cee,_0x560fca(0x14e)+_0x5c72bc);try{const _0x4cd503=new AbortController(),_0x1da481=setTimeout(()=>_0x4cd503[_0x560fca(0x1dd)](),POLYGRAPH_FETCH_TIMEOUT_MS),_0x53fcfa=await fetch(_0x59fc7b,{'method':_0x560fca(0x216),'headers':_0x22278e,'body':_0x5c72bc,'signal':_0x4cd503['signal']});clearTimeout(_0x1da481);const _0x395552=await _0x53fcfa[_0x560fca(0x1bd)]();if(!_0x53fcfa['ok'])return _0x224cee['log']('PR\x20creation\x20failed:\x20'+_0x53fcfa[_0x560fca(0x16b)]+'\x20'+_0x395552),{'success':![],'error':_0x560fca(0x169)+_0x53fcfa[_0x560fca(0x16b)]+':\x20'+_0x395552};const _0x48324d=JSON[_0x560fca(0x1d3)](_0x395552);return _0x224cee[_0x560fca(0x239)](_0x560fca(0x1c9)+_0x48324d[_0x560fca(0x12c)]),{'success':!![],..._0x48324d};}catch(_0x4fc024){const _0x1a374c=_0x4fc024 instanceof Error?_0x4fc024[_0x560fca(0x163)]:String(_0x4fc024);return _0x224cee['log'](_0x560fca(0x14f)+_0x1a374c),{'success':![],'error':_0x560fca(0x1c2)+_0x1a374c};}}async function getPolygraphSession(_0x4ebd28,_0x2e4cfa){const _0x7ebb32=a4_0x197750;var _0x307eee,_0x20405a;const _0x17b891=_0x2e4cfa['nxCloudUrl']+'/nx-cloud/polygraph/session/'+_0x2e4cfa[_0x7ebb32(0x12a)],_0x5d2e11={'Content-Type':'application/json',..._0x2e4cfa[_0x7ebb32(0x193)]};_0x4ebd28[_0x7ebb32(0x239)](_0x7ebb32(0x14d)+_0x17b891);try{const _0x1b235d=new AbortController(),_0x553a51=setTimeout(()=>_0x1b235d[_0x7ebb32(0x1dd)](),POLYGRAPH_FETCH_TIMEOUT_MS),_0x1d0b9a=await fetch(_0x17b891,{'method':_0x7ebb32(0x1e0),'headers':_0x5d2e11,'signal':_0x1b235d['signal']});clearTimeout(_0x553a51);const _0x182781=await _0x1d0b9a['text']();if(!_0x1d0b9a['ok'])return _0x4ebd28[_0x7ebb32(0x239)]('Failed\x20to\x20fetch\x20session:\x20'+_0x1d0b9a[_0x7ebb32(0x16b)]+'\x20'+_0x182781),{'success':![],'error':_0x7ebb32(0x1f1)+_0x1d0b9a['status']+':\x20'+_0x182781};const _0x25ecc7=JSON[_0x7ebb32(0x1d3)](_0x182781);return _0x4ebd28[_0x7ebb32(0x239)](_0x7ebb32(0x135)+(((_0x307eee=_0x25ecc7[_0x7ebb32(0x1e9)])==null?void 0x0:_0x307eee[_0x7ebb32(0x23c)])??0x0)+_0x7ebb32(0x123)+(((_0x20405a=_0x25ecc7['pullRequests'])==null?void 0x0:_0x20405a[_0x7ebb32(0x23c)])??0x0)+_0x7ebb32(0x14b)),{'success':!![],'session':_0x25ecc7};}catch(_0x6ff97b){const _0x37575e=_0x6ff97b instanceof Error?_0x6ff97b['message']:String(_0x6ff97b);return _0x4ebd28[_0x7ebb32(0x239)](_0x7ebb32(0x1fc)+_0x37575e),{'success':![],'error':_0x7ebb32(0x128)+_0x37575e};}}var import_child_process2=require(a4_0x197750(0x1a0)),import_fs=require('fs'),import_os=require('os'),import_path=require(a4_0x197750(0x12d));async function initPolygraphSession(_0x2f9b85,_0x2eade1){const _0x2d7d74=a4_0x197750;var _0xc29f8a;const _0x450f9d=_0x2eade1[_0x2d7d74(0x14c)]+_0x2d7d74(0x144),_0x2a9494={'Content-Type':_0x2d7d74(0x1a7),..._0x2eade1[_0x2d7d74(0x193)]},_0x38cd10=JSON[_0x2d7d74(0x143)]({'sessionId':_0x2eade1[_0x2d7d74(0x12a)],'workspaceId':_0x2eade1['nxCloudId'],'additionalContext':''});_0x2f9b85['log'](_0x2d7d74(0x171)+_0x450f9d),_0x2f9b85[_0x2d7d74(0x239)](_0x2d7d74(0x147)+JSON[_0x2d7d74(0x143)](_0x2a9494,null,0x2)),_0x2f9b85['log']('Request\x20body:\x20'+_0x38cd10);try{const _0x48d69a=new AbortController(),_0x555b4b=setTimeout(()=>_0x48d69a['abort'](),POLYGRAPH_FETCH_TIMEOUT_MS),_0x422d5e=await fetch(_0x450f9d,{'method':_0x2d7d74(0x216),'headers':_0x2a9494,'body':_0x38cd10,'signal':_0x48d69a['signal']});clearTimeout(_0x555b4b);const _0x5ad30c=await _0x422d5e[_0x2d7d74(0x1bd)]();if(!_0x422d5e['ok']){if(_0x422d5e['status']===0x191)return _0x2f9b85[_0x2d7d74(0x239)](_0x2d7d74(0x1e6)+_0x5ad30c),{'url':_0x450f9d,'error':{'type':'authentication','message':_0x5ad30c}};return _0x2f9b85[_0x2d7d74(0x239)](_0x2d7d74(0x205)+_0x422d5e[_0x2d7d74(0x16b)]+'\x20'+_0x5ad30c),{'url':_0x450f9d,'error':{'type':_0x2d7d74(0x1c3),'message':_0x5ad30c}};}const _0xf8dd1f=JSON[_0x2d7d74(0x1d3)](_0x5ad30c);return(_0xc29f8a=_0x2f9b85[_0x2d7d74(0x1ba)])==null?void 0x0:_0xc29f8a[_0x2d7d74(0x176)](_0x2f9b85,_0x2d7d74(0x22f)+JSON[_0x2d7d74(0x143)](_0xf8dd1f)),{'url':_0x450f9d,'data':_0xf8dd1f};}catch(_0x5d3360){const _0x4d7ba8=_0x5d3360 instanceof Error?_0x5d3360[_0x2d7d74(0x163)]:String(_0x5d3360);return _0x2f9b85['log'](_0x2d7d74(0x1aa)+_0x4d7ba8),{'url':_0x450f9d,'error':{'type':'network','message':_0x4d7ba8}};}}function getRegistryPath(_0x558876,_0x417f56){const _0xfdb3b3=a4_0x197750;return(0x0,import_path[_0xfdb3b3(0x1fa)])(_0x558876,_0xfdb3b3(0x234),'polygraph',_0x417f56,_0xfdb3b3(0x1ae));}async function ensurePolygraphGitignore(_0x43926d){const _0x59cce8=a4_0x197750,_0x2ca79b=(0x0,import_path['join'])(_0x43926d,_0x59cce8(0x23d));if(!(0x0,import_fs[_0x59cce8(0x214)])(_0x2ca79b))return;const _0x55a0f6=(0x0,import_fs['readFileSync'])(_0x2ca79b,_0x59cce8(0x1be)),_0x1e7815=_0x55a0f6[_0x59cce8(0x20c)]('\x0a');if(_0x1e7815[_0x59cce8(0x165)](_0x2d4fac=>_0x2d4fac[_0x59cce8(0x20b)]()===_0x59cce8(0x13f)||_0x2d4fac['trim']()===_0x59cce8(0x1af)))return;const _0x2a6e42=_0x55a0f6[_0x59cce8(0x19d)]('\x0a')?_0x55a0f6+_0x59cce8(0x183):_0x55a0f6+_0x59cce8(0x1a8);(0x0,import_fs[_0x59cce8(0x140)])(_0x2ca79b,_0x2a6e42,_0x59cce8(0x1be));}function a4_0x32f1(_0x3d272f,_0x533e2c){const _0x3e0d7b=a4_0x3e0d();return a4_0x32f1=function(_0x32f149,_0x2154cb){_0x32f149=_0x32f149-0x115;let _0x32d9ff=_0x3e0d7b[_0x32f149];return _0x32d9ff;},a4_0x32f1(_0x3d272f,_0x533e2c);}function loadRepoRegistry(_0x41c5d7){const _0x47078b=a4_0x197750;if(!(0x0,import_fs['existsSync'])(_0x41c5d7))return null;try{const _0x21df26=(0x0,import_fs[_0x47078b(0x120)])(_0x41c5d7,_0x47078b(0x1be));return JSON[_0x47078b(0x1d3)](_0x21df26);}catch{return null;}}function saveRepoRegistry(_0xdeca5b,_0x102d77){const _0x20afa1=a4_0x197750,_0x190bf1=(0x0,import_path[_0x20afa1(0x13b)])(_0xdeca5b);!(0x0,import_fs['existsSync'])(_0x190bf1)&&(0x0,import_fs['mkdirSync'])(_0x190bf1,{'recursive':!![]}),(0x0,import_fs[_0x20afa1(0x140)])(_0xdeca5b,JSON['stringify'](_0x102d77,null,0x2),_0x20afa1(0x1be));}function getClonePath(_0x12ef26,_0x22fe89){const _0x564a4b=a4_0x197750;return(0x0,import_path[_0x564a4b(0x1fa)])((0x0,import_os[_0x564a4b(0x178)])(),'polygraph',_0x12ef26,_0x22fe89);}function isValidClone(_0x5e0706){const _0x5e2343=a4_0x197750;if(!(0x0,import_fs[_0x5e2343(0x214)])(_0x5e0706))return![];try{return(0x0,import_child_process2[_0x5e2343(0x1f6)])(_0x5e2343(0x22d),{'cwd':_0x5e0706,'stdio':'pipe'}),!![];}catch{return![];}}function detectPackageManager(_0xc4b5e){const _0x20bc34=a4_0x197750;if((0x0,import_fs[_0x20bc34(0x214)])((0x0,import_path['join'])(_0xc4b5e,_0x20bc34(0x15a))))return _0x20bc34(0x136);if((0x0,import_fs[_0x20bc34(0x214)])((0x0,import_path[_0x20bc34(0x1fa)])(_0xc4b5e,'yarn.lock')))return _0x20bc34(0x168);if((0x0,import_fs[_0x20bc34(0x214)])((0x0,import_path[_0x20bc34(0x1fa)])(_0xc4b5e,_0x20bc34(0x1f2))))return _0x20bc34(0x181);return _0x20bc34(0x184);}function installDependencies(_0x7661a5,_0x5cf1d9){const _0x4b3c6f=a4_0x197750,_0x362bd4=detectPackageManager(_0x7661a5),_0x4483f9=_0x362bd4==='npm'?_0x4b3c6f(0x191):_0x362bd4+_0x4b3c6f(0x18c);_0x5cf1d9['log'](_0x4b3c6f(0x122)+_0x362bd4+_0x4b3c6f(0x1ee)+_0x7661a5);try{(0x0,import_child_process2['execSync'])(_0x4483f9,{'cwd':_0x7661a5,'stdio':'ignore','env':{...process[_0x4b3c6f(0x151)]}}),_0x5cf1d9['log'](_0x4b3c6f(0x15d));}catch(_0x5a95f0){const _0x245112=_0x5a95f0 instanceof Error?_0x5a95f0[_0x4b3c6f(0x163)]:String(_0x5a95f0);throw new Error(_0x4b3c6f(0x118)+_0x362bd4+':\x20'+_0x245112);}}function resetCloneToCleanState(_0x48236f,_0xe739ad,_0x2187bf){const _0x44394e=a4_0x197750;_0x2187bf[_0x44394e(0x239)](_0x44394e(0x117)+_0x48236f+_0x44394e(0x1b7)+_0xe739ad);const _0x28159c={...process[_0x44394e(0x151)],'GIT_TERMINAL_PROMPT':'0'},_0x5ebb2a=validateGitRef(_0xe739ad,_0x44394e(0x1a4));if(_0x5ebb2a)throw new Error(_0x5ebb2a);try{(0x0,import_child_process2['execFileSync'])(_0x44394e(0x1f8),[_0x44394e(0x1b4),_0xe739ad],{'cwd':_0x48236f,'stdio':_0x44394e(0x199),'env':_0x28159c}),(0x0,import_child_process2[_0x44394e(0x211)])(_0x44394e(0x1f8),[_0x44394e(0x1cf),_0x44394e(0x158)],{'cwd':_0x48236f,'stdio':_0x44394e(0x199),'env':_0x28159c}),(0x0,import_child_process2[_0x44394e(0x211)])(_0x44394e(0x1f8),[_0x44394e(0x150),'-fd'],{'cwd':_0x48236f,'stdio':'pipe','env':_0x28159c}),(0x0,import_child_process2['execFileSync'])(_0x44394e(0x1f8),[_0x44394e(0x21e),_0x44394e(0x189),_0xe739ad],{'cwd':_0x48236f,'stdio':'pipe','env':_0x28159c});}catch(_0x58daf1){const _0xc39df5=_0x58daf1 instanceof Error?_0x58daf1[_0x44394e(0x163)]:String(_0x58daf1);throw new Error(_0x44394e(0x19e)+_0x48236f+':\x20'+_0xc39df5);}}function cloneRepo(_0x2638c5,_0x5e7ba7,_0x42d780,_0x4b6945){const _0xa4826b=a4_0x197750;_0x4b6945[_0xa4826b(0x239)](_0xa4826b(0x142)+_0x2638c5+_0xa4826b(0x1b7)+_0x42d780);const _0x57b5a3=(0x0,import_path[_0xa4826b(0x13b)])(_0x42d780);!(0x0,import_fs['existsSync'])(_0x57b5a3)&&(0x0,import_fs[_0xa4826b(0x19a)])(_0x57b5a3,{'recursive':!![]});const _0x4aaff7=_0xa4826b(0x14a)+_0x5e7ba7+_0xa4826b(0x20f)+_0x2638c5+'.git';try{execGitWithToken([_0xa4826b(0x133),_0xa4826b(0x139),'1',_0x4aaff7,_0x42d780]);}catch(_0x5c6c77){const _0x333fbf=_0x5c6c77 instanceof Error?_0x5c6c77[_0xa4826b(0x163)]:String(_0x5c6c77);throw new Error(_0xa4826b(0x1b1)+_0x2638c5+':\x20'+sanitizeError(_0x333fbf));}}function cloneOrResetRepo(_0x4be7dc,_0x3d2204,_0x243150,_0x17dd96,_0x4abf76){const _0x4d9407=a4_0x197750,_0x2929f9=_0x4be7dc[_0x4d9407(0x196)]['repositoryFullName'],_0x346818=_0x2929f9['split']('/')['pop']()??_0x2929f9,_0x57d942=getClonePath(_0x243150,_0x346818);if(_0x3d2204[_0x4d9407(0x134)]<Date[_0x4d9407(0x1ea)]())throw new Error(_0x4d9407(0x1e7)+_0x4be7dc[_0x4d9407(0x217)]+_0x4d9407(0x1bb));const _0x5a1157=_0x17dd96['repos']['find'](_0x1708a8=>_0x1708a8['workspaceId']===_0x4be7dc['id']);if(_0x5a1157&&isValidClone(_0x5a1157[_0x4d9407(0x15e)]))return resetCloneToCleanState(_0x5a1157[_0x4d9407(0x15e)],_0x4be7dc[_0x4d9407(0x17e)],_0x4abf76),_0x5a1157;return isValidClone(_0x57d942)?(_0x4abf76[_0x4d9407(0x239)](_0x4d9407(0x124)+_0x57d942+'\x20already\x20exists,\x20resetting\x20to\x20clean\x20state'),resetCloneToCleanState(_0x57d942,_0x4be7dc[_0x4d9407(0x17e)],_0x4abf76)):cloneRepo(_0x2929f9,_0x3d2204[_0x4d9407(0x1a5)],_0x57d942,_0x4abf76),installDependencies(_0x57d942,_0x4abf76),{'workspaceId':_0x4be7dc['id'],'repoFullName':_0x2929f9,'localPath':_0x57d942,'defaultBranch':_0x4be7dc['defaultBranch'],'initiator':_0x4be7dc[_0x4d9407(0x226)],'clonedAt':Date[_0x4d9407(0x1ea)]()};}async function clonePolygraphRepositories(_0x5b6706,_0xc64b5f,_0x279723){const _0xb429cc=a4_0x197750,{sessionId:_0x5ecc2d,workspaces:_0x3a2fbb,credentials:_0x971b57}=_0x279723;try{await ensurePolygraphGitignore(_0x5b6706);const _0x5008fe=getRegistryPath(_0x5b6706,_0x5ecc2d);let _0x3c87eb=loadRepoRegistry(_0x5008fe);!_0x3c87eb&&(_0x3c87eb={'sessionId':_0x5ecc2d,'createdAt':Date['now'](),'repos':[]});const _0x41f82a=[],_0x3c1b58=_0x3a2fbb['find'](_0x419e85=>_0x419e85[_0xb429cc(0x226)]);_0x3c1b58&&_0x41f82a[_0xb429cc(0x235)]({'workspaceId':_0x3c1b58['id'],'repoFullName':_0x3c1b58['vcsConfiguration'][_0xb429cc(0x223)],'localPath':_0x5b6706,'defaultBranch':_0x3c1b58[_0xb429cc(0x17e)],'initiator':!![],'clonedAt':Date['now']()});const _0x5e2ce9=_0x3a2fbb['filter'](_0x638fe4=>!_0x638fe4[_0xb429cc(0x226)]);for(const _0x11ddf4 of _0x5e2ce9){const _0x3fa74=_0x971b57[_0xb429cc(0x153)](_0x20a4de=>_0x20a4de['workspaceId']===_0x11ddf4['id']);if(!_0x3fa74)throw new Error(_0xb429cc(0x1ed)+_0x11ddf4[_0xb429cc(0x217)]+'\x20('+_0x11ddf4['id']+')');const _0x2ff798=cloneOrResetRepo(_0x11ddf4,_0x3fa74,_0x5ecc2d,_0x3c87eb,_0xc64b5f);_0x41f82a['push'](_0x2ff798);}return _0x3c87eb[_0xb429cc(0x1ef)]=_0x41f82a,saveRepoRegistry(_0x5008fe,_0x3c87eb),{'success':!![],'sessionId':_0x5ecc2d,'clones':_0x41f82a};}catch(_0x3a4595){const _0x2371ad=_0x3a4595 instanceof Error?_0x3a4595[_0xb429cc(0x163)]:String(_0x3a4595);return _0xc64b5f[_0xb429cc(0x239)](_0xb429cc(0x23a)+_0x2371ad),{'success':![],'sessionId':_0x5ecc2d,'clones':[],'error':_0x2371ad};}}async function markPolygraphPRsReady(_0x35f2d1,_0x25caa0){const _0x26ba4b=a4_0x197750,_0x4724f1=_0x25caa0[_0x26ba4b(0x14c)]+_0x26ba4b(0x194)+_0x25caa0[_0x26ba4b(0x12a)]+'/prs/mark-ready',_0x2b06a4={'Content-Type':_0x26ba4b(0x1a7),..._0x25caa0[_0x26ba4b(0x193)]};_0x35f2d1[_0x26ba4b(0x239)](_0x26ba4b(0x1cb)+_0x4724f1);try{const _0x2eb36f=new AbortController(),_0x332764=setTimeout(()=>_0x2eb36f[_0x26ba4b(0x1dd)](),POLYGRAPH_FETCH_TIMEOUT_MS),_0x4ba221=await fetch(_0x4724f1,{'method':_0x26ba4b(0x216),'headers':_0x2b06a4,'body':JSON['stringify']({'prUrls':_0x25caa0[_0x26ba4b(0x1b2)]}),'signal':_0x2eb36f[_0x26ba4b(0x209)]});clearTimeout(_0x332764);const _0x54c6a6=await _0x4ba221[_0x26ba4b(0x1bd)]();if(!_0x4ba221['ok'])return _0x35f2d1[_0x26ba4b(0x239)](_0x26ba4b(0x1d2)+_0x4ba221[_0x26ba4b(0x16b)]+'\x20'+_0x54c6a6),{'success':![],'error':_0x26ba4b(0x1c6)+_0x4ba221[_0x26ba4b(0x16b)]+':\x20'+_0x54c6a6};const _0x261a76=JSON['parse'](_0x54c6a6),_0x5d355b=_0x261a76[_0x26ba4b(0x22e)][_0x26ba4b(0x1d4)](_0x5c0d4b=>({'url':_0x5c0d4b['prUrl'],'number':_0x5c0d4b[_0x26ba4b(0x23b)],'success':_0x5c0d4b['success'],'error':_0x5c0d4b[_0x26ba4b(0x207)]}));return _0x35f2d1[_0x26ba4b(0x239)](_0x26ba4b(0x1f4)+_0x5d355b[_0x26ba4b(0x1e8)](_0x37fbab=>_0x37fbab[_0x26ba4b(0x148)])[_0x26ba4b(0x23c)]+'/'+_0x5d355b[_0x26ba4b(0x23c)]+_0x26ba4b(0x1c8)),{'success':!![],'results':_0x5d355b,'allSucceeded':_0x261a76['allSucceeded']};}catch(_0x44eeb7){const _0x46a25a=_0x44eeb7 instanceof Error?_0x44eeb7[_0x26ba4b(0x163)]:String(_0x44eeb7);return _0x35f2d1['log'](_0x26ba4b(0x1d2)+_0x46a25a),{'success':![],'error':_0x26ba4b(0x13c)+_0x46a25a};}}var import_child_process3=require('child_process'),import_fs2=require('fs'),import_path2=require('path');function ensureSandboxSettings(_0x2063fb){const _0x592f3a=a4_0x197750,_0x4de1bd=(0x0,import_path2[_0x592f3a(0x1fa)])(_0x2063fb,_0x592f3a(0x1d6));!(0x0,import_fs2[_0x592f3a(0x214)])(_0x4de1bd)&&(0x0,import_fs2[_0x592f3a(0x19a)])(_0x4de1bd,{'recursive':!![]});const _0x3e6a34=(0x0,import_path2[_0x592f3a(0x1fa)])(_0x4de1bd,_0x592f3a(0x190)),_0x3335d8={'sandbox':{'enabled':!![],'autoAllowBashIfSandboxed':!![],'allowUnsandboxedCommands':![]}};(0x0,import_fs2[_0x592f3a(0x140)])(_0x3e6a34,JSON[_0x592f3a(0x143)](_0x3335d8,null,0x2),'utf-8');}var POLYGRAPH_CHILD_SYSTEM_PROMPT=a4_0x197750(0x1a3),ChildAgentManager=class{constructor(_0x3d0334){const _0x53e441=a4_0x197750;this[_0x53e441(0x186)]=_0x3d0334;}[a4_0x197750(0x16e)]=new Map();[a4_0x197750(0x20d)]=0x3;[a4_0x197750(0x180)]=0x5*0x3c*0x3e8;async['executeTask'](_0x1796d4,_0x1f8002,_0x558a82,_0x2789d8,_0x4a9a01){const _0x182e49=a4_0x197750;let _0x140eab=this[_0x182e49(0x16e)][_0x182e49(0x157)](_0x1796d4);!_0x140eab&&(_0x140eab={'workspaceId':_0x1796d4,'repoPath':_0x1f8002,'process':null,'status':_0x182e49(0x1ff),'hasExistingSession':![],'retryCount':0x0},this[_0x182e49(0x16e)][_0x182e49(0x127)](_0x1796d4,_0x140eab));if(_0x140eab['retryCount']>=this[_0x182e49(0x20d)])return{'status':_0x182e49(0x187),'output':'','error':_0x182e49(0x1dc)+this[_0x182e49(0x20d)]+_0x182e49(0x1c0)+_0x1796d4};const _0x203922=_0x2789d8?_0x182e49(0x16f)+_0x2789d8+_0x182e49(0x166)+_0x558a82:_0x558a82;ensureSandboxSettings(_0x1f8002);const _0x16b8c0=[_0x182e49(0x137),_0x182e49(0x229),_0x182e49(0x22c),POLYGRAPH_CHILD_SYSTEM_PROMPT];return _0x140eab[_0x182e49(0x125)]?(_0x16b8c0['unshift']('--continue'),this['logger'][_0x182e49(0x239)](_0x182e49(0x1de)+_0x1796d4)):this[_0x182e49(0x186)][_0x182e49(0x239)](_0x182e49(0x238)+_0x1796d4),this[_0x182e49(0x186)]['log'](_0x182e49(0x1df)+_0x1f8002),this[_0x182e49(0x186)][_0x182e49(0x239)]('Prompt:\x20'+_0x203922[_0x182e49(0x228)](0x0,0xc8)+_0x182e49(0x225)),new Promise(_0x4b7b28=>{const _0x3699ec=_0x182e49;_0x140eab['status']=_0x3699ec(0x1fd);const _0x33ee75=(0x0,import_child_process3[_0x3699ec(0x1ac)])(_0x3699ec(0x1c1),_0x16b8c0,{'cwd':_0x1f8002,'env':{...process[_0x3699ec(0x151)]}});_0x140eab['process']=_0x33ee75;let _0x49b613='',_0x4477d0='';_0x33ee75[_0x3699ec(0x182)]['write'](_0x203922),_0x33ee75[_0x3699ec(0x182)][_0x3699ec(0x188)](),_0x33ee75[_0x3699ec(0x185)]['on'](_0x3699ec(0x17b),_0x15eff4=>{const _0x24ab3e=_0x3699ec,_0x4ef1ba=_0x15eff4['toString']();_0x49b613+=_0x4ef1ba,this[_0x24ab3e(0x186)]['log']('['+_0x1796d4+']\x20stdout:\x20'+_0x4ef1ba['substring'](0x0,0x64)+(_0x4ef1ba[_0x24ab3e(0x23c)]>0x64?'...':'')),_0x4a9a01==null?void 0x0:_0x4a9a01(_0x4ef1ba);}),_0x33ee75[_0x3699ec(0x17a)]['on'](_0x3699ec(0x17b),_0x5cee41=>{const _0x69f4cd=_0x3699ec,_0x274ab2=_0x5cee41[_0x69f4cd(0x1c5)]();_0x4477d0+=_0x274ab2,this[_0x69f4cd(0x186)][_0x69f4cd(0x239)]('['+_0x1796d4+_0x69f4cd(0x1d1)+_0x274ab2);});const _0x401310=setTimeout(()=>{const _0x12188a=_0x3699ec;this[_0x12188a(0x186)][_0x12188a(0x239)]('['+_0x1796d4+_0x12188a(0x116)+this[_0x12188a(0x180)]+'ms'),_0x33ee75[_0x12188a(0x224)](),_0x140eab[_0x12188a(0x16b)]='failed',_0x140eab[_0x12188a(0x1da)]=null,_0x140eab['retryCount']++,_0x4b7b28({'status':_0x12188a(0x187),'output':_0x49b613,'error':'Task\x20timed\x20out\x20after\x20'+this[_0x12188a(0x180)]/0x3e8+_0x12188a(0x12f)});},this[_0x3699ec(0x180)]);_0x33ee75['on'](_0x3699ec(0x155),_0x47b906=>{const _0x1b01f0=_0x3699ec;clearTimeout(_0x401310),_0x140eab['process']=null,this[_0x1b01f0(0x186)]['log']('['+_0x1796d4+_0x1b01f0(0x160)+_0x47b906),_0x47b906===0x0?(_0x140eab[_0x1b01f0(0x125)]=!![],_0x140eab[_0x1b01f0(0x16b)]=_0x1b01f0(0x15f),_0x140eab[_0x1b01f0(0x1bf)]=0x0,_0x4b7b28({'status':_0x1b01f0(0x15f),'output':_0x49b613})):(_0x140eab[_0x1b01f0(0x16b)]='failed',_0x140eab[_0x1b01f0(0x1bf)]++,_0x4b7b28({'status':_0x1b01f0(0x187),'output':_0x49b613,'error':'Claude\x20exited\x20with\x20code\x20'+_0x47b906+(_0x4477d0?_0x1b01f0(0x21f)+_0x4477d0:'')}));}),_0x33ee75['on'](_0x3699ec(0x207),_0x54dfd9=>{const _0x10f961=_0x3699ec;clearTimeout(_0x401310),_0x140eab[_0x10f961(0x1da)]=null,_0x140eab['status']=_0x10f961(0x187),_0x140eab[_0x10f961(0x1bf)]++,this[_0x10f961(0x186)][_0x10f961(0x239)]('['+_0x1796d4+_0x10f961(0x11f)+_0x54dfd9[_0x10f961(0x163)]),_0x4b7b28({'status':'failed','output':_0x49b613,'error':'Failed\x20to\x20spawn\x20Claude:\x20'+_0x54dfd9[_0x10f961(0x163)]});});});}[a4_0x197750(0x12b)](_0x2babad){const _0x475aee=a4_0x197750,_0x204ad0=this[_0x475aee(0x16e)]['get'](_0x2babad);if(!_0x204ad0)return!![];return _0x204ad0[_0x475aee(0x1bf)]<this[_0x475aee(0x20d)];}[a4_0x197750(0x132)](_0x1b54e6){const _0xadc3f6=this['agents']['get'](_0x1b54e6);return(_0xadc3f6==null?void 0x0:_0xadc3f6['status'])??null;}[a4_0x197750(0x224)](_0x535a01){const _0x3b07e9=a4_0x197750,_0x4acf12=this['agents'][_0x3b07e9(0x157)](_0x535a01);(_0x4acf12==null?void 0x0:_0x4acf12['process'])&&(this[_0x3b07e9(0x186)][_0x3b07e9(0x239)](_0x3b07e9(0x18f)+_0x535a01),_0x4acf12['process'][_0x3b07e9(0x224)](),_0x4acf12[_0x3b07e9(0x1da)]=null,_0x4acf12['status']=_0x3b07e9(0x187));}[a4_0x197750(0x222)](){const _0x216548=a4_0x197750;this[_0x216548(0x186)][_0x216548(0x239)](_0x216548(0x195));for(const [_0x10b2b0]of this[_0x216548(0x16e)]){this[_0x216548(0x224)](_0x10b2b0);}}['resetSession'](_0x3af416){const _0x3e4021=a4_0x197750,_0x505a26=this[_0x3e4021(0x16e)][_0x3e4021(0x157)](_0x3af416);_0x505a26&&(_0x505a26[_0x3e4021(0x125)]=![],_0x505a26['retryCount']=0x0,_0x505a26['status']=_0x3e4021(0x1ff),this['logger'][_0x3e4021(0x239)](_0x3e4021(0x1bc)+_0x3af416));}[a4_0x197750(0x175)](){const _0x448c97=a4_0x197750;let _0x2d3442=0x0;for(const _0x55cc37 of this[_0x448c97(0x16e)][_0x448c97(0x15c)]()){_0x55cc37[_0x448c97(0x1da)]!==null&&_0x2d3442++;}return _0x2d3442;}},import_child_process4=require(a4_0x197750(0x1a0));async function getPolygraphCredentials(_0x2f4ae4,_0x56efcd){const _0x36cebf=a4_0x197750,_0x65bb48=_0x56efcd[_0x36cebf(0x14c)]+'/nx-cloud/polygraph/session/'+_0x56efcd['sessionId']+_0x36cebf(0x12e),_0x4dc959={'Content-Type':_0x36cebf(0x1a7),..._0x56efcd['authHeaders']};_0x2f4ae4[_0x36cebf(0x239)]('Fetching\x20session\x20credentials\x20from:\x20'+_0x65bb48);try{const _0xf1dff=new AbortController(),_0x5814bd=setTimeout(()=>_0xf1dff[_0x36cebf(0x1dd)](),POLYGRAPH_FETCH_TIMEOUT_MS),_0x81ab72=await fetch(_0x65bb48,{'method':_0x36cebf(0x216),'headers':_0x4dc959,'signal':_0xf1dff[_0x36cebf(0x209)]});clearTimeout(_0x5814bd);const _0x11bd2b=await _0x81ab72[_0x36cebf(0x1bd)]();if(!_0x81ab72['ok'])return _0x2f4ae4['log'](_0x36cebf(0x202)+_0x81ab72[_0x36cebf(0x16b)]+'\x20'+_0x11bd2b),{'success':![],'error':_0x36cebf(0x1db)+_0x81ab72[_0x36cebf(0x16b)]+':\x20'+_0x11bd2b};const _0x3a3cd8=JSON[_0x36cebf(0x1d3)](_0x11bd2b);return _0x2f4ae4['log'](_0x36cebf(0x208)+_0x3a3cd8['credentials'][_0x36cebf(0x23c)]+'\x20credential(s)'),{'success':!![],'credentials':_0x3a3cd8['credentials']};}catch(_0x3cb302){const _0x14a964=_0x3cb302 instanceof Error?_0x3cb302['message']:String(_0x3cb302);return _0x2f4ae4['log']('Failed\x20to\x20fetch\x20credentials:\x20'+_0x14a964),{'success':![],'error':_0x36cebf(0x1f0)+_0x14a964};}}function getDefaultBranch(_0x4de2ce,_0x56e135=a4_0x197750(0x11c)){const _0x36b5a5=a4_0x197750;try{const _0x3d8e80=(0x0,import_child_process4[_0x36b5a5(0x1f6)])('git\x20rev-parse\x20--abbrev-ref\x20origin/HEAD',{'cwd':_0x4de2ce,'stdio':_0x36b5a5(0x199),'env':{...process[_0x36b5a5(0x151)],'GIT_TERMINAL_PROMPT':'0'}})[_0x36b5a5(0x1c5)]()[_0x36b5a5(0x20b)](),_0x53f65a=_0x3d8e80[_0x36b5a5(0x20c)]('/');return _0x53f65a[_0x36b5a5(0x23c)]>0x1?_0x53f65a[_0x36b5a5(0x213)](0x1)['join']('/'):_0x56e135;}catch{return _0x56e135;}}function parseRemoteUrl(_0x1b91d6){const _0x45c3bf=a4_0x197750,_0x279111=_0x1b91d6[_0x45c3bf(0x1a1)](/https?:\/\/[^/]*github\.com\/([^/]+)\/([^/]+?)(\.git)?$/);if(_0x279111)return{'owner':_0x279111[0x1],'repo':_0x279111[0x2]};const _0x1527e9=_0x1b91d6[_0x45c3bf(0x1a1)](/git@github\.com:([^/]+)\/(.+?)(\.git)?$/);if(_0x1527e9)return{'owner':_0x1527e9[0x1],'repo':_0x1527e9[0x2]};return null;}async function pushPolygraphBranch(_0x421913,_0x4ffc95){const _0x3a8836=a4_0x197750,_0x597ff9={...process['env'],'GIT_TERMINAL_PROMPT':'0'},_0x1861ef=getRegistryPath(_0x4ffc95[_0x3a8836(0x145)],_0x4ffc95['sessionId']),_0x3ea049=loadRepoRegistry(_0x1861ef);if(!_0x3ea049)return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x215)+_0x4ffc95[_0x3a8836(0x12a)]),{'success':![],'error':'No\x20Polygraph\x20session\x20found\x20with\x20ID:\x20'+_0x4ffc95[_0x3a8836(0x12a)],'phase':_0x3a8836(0x1c7)};const _0x3cc9be=_0x3ea049['repos'][_0x3a8836(0x153)](_0xb117dc=>_0xb117dc[_0x3a8836(0x15e)]===_0x4ffc95[_0x3a8836(0x16d)]);if(!_0x3cc9be)return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x1d8)+_0x4ffc95[_0x3a8836(0x16d)]+_0x3a8836(0x17d)),{'success':![],'error':_0x3a8836(0x1d8)+_0x4ffc95['repoPath']+'\x20not\x20found\x20in\x20session','phase':'validation'};_0x421913[_0x3a8836(0x239)](_0x3a8836(0x138)+_0x3cc9be[_0x3a8836(0x1ab)]+_0x3a8836(0x19b)+_0x3cc9be['workspaceId']+')');const _0x1292fe=await getPolygraphCredentials(_0x421913,{'sessionId':_0x4ffc95[_0x3a8836(0x12a)],'nxCloudUrl':_0x4ffc95[_0x3a8836(0x14c)],'authHeaders':_0x4ffc95[_0x3a8836(0x193)]});if(!_0x1292fe[_0x3a8836(0x148)])return _0x421913['log'](_0x3a8836(0x1c4)+_0x1292fe[_0x3a8836(0x207)]),{'success':![],'error':'Failed\x20to\x20get\x20credentials:\x20'+_0x1292fe['error'],'phase':'credentials'};const _0x53426c=_0x1292fe[_0x3a8836(0x212)][_0x3a8836(0x153)](_0x4af3ab=>_0x4af3ab[_0x3a8836(0x1f7)]===_0x3cc9be[_0x3a8836(0x1f7)]);if(!_0x53426c)return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x1ed)+_0x3cc9be[_0x3a8836(0x1f7)]),{'success':![],'error':_0x3a8836(0x1ed)+_0x3cc9be[_0x3a8836(0x1f7)],'phase':_0x3a8836(0x212)};_0x421913[_0x3a8836(0x239)](_0x3a8836(0x1b9)+_0x3cc9be[_0x3a8836(0x1f7)]);const [_0x440f58,_0xa8fbd2]=_0x3cc9be['repoFullName']['split']('/');try{const _0x122585=(0x0,import_child_process4['execSync'])(_0x3a8836(0x1ca),{'cwd':_0x4ffc95[_0x3a8836(0x16d)],'stdio':_0x3a8836(0x199),'env':_0x597ff9})[_0x3a8836(0x1c5)]()[_0x3a8836(0x20b)]();_0x421913[_0x3a8836(0x239)]('Remote\x20origin\x20URL:\x20'+_0x122585);const _0x1ddf4a=parseRemoteUrl(_0x122585);if(!_0x1ddf4a)return{'success':![],'error':_0x3a8836(0x1ce)+_0x122585,'phase':_0x3a8836(0x1c7)};if(_0x1ddf4a[_0x3a8836(0x131)][_0x3a8836(0x1b0)]()!==_0x440f58['toLowerCase']()||_0x1ddf4a[_0x3a8836(0x11e)][_0x3a8836(0x1b0)]()!==_0xa8fbd2[_0x3a8836(0x1b0)]())return _0x421913[_0x3a8836(0x239)]('Remote\x20mismatch:\x20expected\x20'+_0x440f58+'/'+_0xa8fbd2+_0x3a8836(0x1e4)+_0x1ddf4a[_0x3a8836(0x131)]+'/'+_0x1ddf4a[_0x3a8836(0x11e)]),{'success':![],'error':_0x3a8836(0x115)+_0x440f58+'/'+_0xa8fbd2,'phase':'validation'};}catch(_0x451b2e){const _0x50ee5b=_0x451b2e instanceof Error?_0x451b2e[_0x3a8836(0x163)]:String(_0x451b2e);return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x152)+sanitizeError(_0x50ee5b)),{'success':![],'error':'Failed\x20to\x20get\x20remote\x20origin\x20URL:\x20'+sanitizeError(_0x50ee5b),'phase':_0x3a8836(0x1c7)};}const _0x2d75f6=validateGitRef(_0x4ffc95['branch'],_0x3a8836(0x1a4));if(_0x2d75f6)return{'success':![],'error':_0x2d75f6,'phase':_0x3a8836(0x1c7)};const _0x2e2a56=getDefaultBranch(_0x4ffc95[_0x3a8836(0x16d)]),_0x34bb58=validateGitRef(_0x2e2a56,_0x3a8836(0x20e));if(_0x34bb58)return{'success':![],'error':_0x34bb58,'phase':_0x3a8836(0x1c7)};_0x421913[_0x3a8836(0x239)](_0x3a8836(0x1a6)+_0x2e2a56);try{const _0x468f53=(0x0,import_child_process4[_0x3a8836(0x211)])(_0x3a8836(0x1f8),['rev-list','--count','origin/'+_0x2e2a56+_0x3a8836(0x13e)],{'cwd':_0x4ffc95[_0x3a8836(0x16d)],'stdio':'pipe','env':_0x597ff9})[_0x3a8836(0x1c5)]()['trim']();if(_0x468f53==='0')return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x201)),{'success':![],'error':_0x3a8836(0x230),'phase':'validation'};_0x421913[_0x3a8836(0x239)](_0x468f53+_0x3a8836(0x19c)+_0x2e2a56);}catch(_0x2c8bac){const _0x4a6cd2=_0x2c8bac instanceof Error?_0x2c8bac[_0x3a8836(0x163)]:String(_0x2c8bac);return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x15b)+sanitizeError(_0x4a6cd2)),{'success':![],'error':_0x3a8836(0x15b)+sanitizeError(_0x4a6cd2),'phase':_0x3a8836(0x1c7)};}const _0x17a598=_0x3a8836(0x14a)+_0x53426c[_0x3a8836(0x1a5)]+_0x3a8836(0x20f)+_0x440f58+'/'+_0xa8fbd2+_0x3a8836(0x1cd);_0x421913['log'](_0x3a8836(0x173)+_0x4ffc95['branch']+_0x3a8836(0x1cc));try{(0x0,import_child_process4['execFileSync'])(_0x3a8836(0x1f8),[_0x3a8836(0x235),_0x3a8836(0x11d),_0x17a598,_0x3a8836(0x20a)+_0x4ffc95[_0x3a8836(0x210)]],{'cwd':_0x4ffc95[_0x3a8836(0x16d)],'stdio':'pipe','env':_0x597ff9}),_0x421913['log'](_0x3a8836(0x121)+_0x4ffc95[_0x3a8836(0x210)]);}catch(_0x3bb989){const _0x39d624=_0x3bb989 instanceof Error?_0x3bb989[_0x3a8836(0x163)]:String(_0x3bb989),_0x514f19=sanitizeError(_0x39d624);return _0x421913[_0x3a8836(0x239)](_0x3a8836(0x1ad)+_0x514f19),{'success':![],'error':'Git\x20push\x20failed:\x20'+_0x514f19,'phase':_0x3a8836(0x235)};}return{'success':!![],'branch':_0x4ffc95[_0x3a8836(0x210)],'remote':_0x3a8836(0x189)};}async function polygraphInit(_0x461cdc,_0x3ad24e){const _0x1ffdaa=a4_0x197750,{sessionId:_0x5a108a,nxCloudId:_0x41a475,nxCloudUrl:_0x40fccf,authHeaders:_0x324395,workspacePath:_0x5ecd3d}=_0x3ad24e,_0x1b1fc9=await initPolygraphSession(_0x461cdc,{'sessionId':_0x5a108a,'nxCloudId':_0x41a475,'nxCloudUrl':_0x40fccf,'authHeaders':_0x324395});if(_0x1b1fc9['error'])return{'success':![],'error':_0x1ffdaa(0x126)+_0x1b1fc9[_0x1ffdaa(0x207)][_0x1ffdaa(0x163)]+'\x0aURL:\x20'+_0x1b1fc9[_0x1ffdaa(0x12c)]};const _0x57f64c=_0x1b1fc9[_0x1ffdaa(0x17b)];if(!(_0x57f64c==null?void 0x0:_0x57f64c['workspaces'])||_0x57f64c[_0x1ffdaa(0x1e9)][_0x1ffdaa(0x23c)]===0x0)return{'success':!![],'sessionId':_0x5a108a,'clonesSummary':'Session\x20initialized\x20but\x20no\x20workspaces\x20returned.\x0aSession\x20ID:\x20'+_0x5a108a};const _0x53654e=await clonePolygraphRepositories(_0x5ecd3d,_0x461cdc,_0x57f64c);if(!_0x53654e[_0x1ffdaa(0x148)])return{'success':![],'error':_0x1ffdaa(0x23a)+_0x53654e[_0x1ffdaa(0x207)]};const _0x21a000=_0x53654e[_0x1ffdaa(0x200)][_0x1ffdaa(0x1d4)](_0x3770f5=>'-\x20'+_0x3770f5['repoFullName']+':\x20'+_0x3770f5['localPath'])['join']('\x0a');return{'success':!![],'sessionId':_0x5a108a,'clonesSummary':'Session\x20initialized\x20successfully.\x0aSession\x20ID:\x20'+_0x5a108a+'\x0a\x0aCloned\x20repositories:\x0a'+_0x21a000+_0x1ffdaa(0x13d)};}var childAgentManager;function getChildAgentManager(_0x1b74a6){const _0x25d2ef=a4_0x197750;if(!childAgentManager){childAgentManager=new ChildAgentManager(_0x1b74a6);const _0x539a75=()=>childAgentManager[_0x25d2ef(0x222)]();process['on']('exit',_0x539a75),process['on'](_0x25d2ef(0x19f),_0x539a75),process['on'](_0x25d2ef(0x1f9),_0x539a75);}return childAgentManager;}async function polygraphDelegate(_0x14f746,_0x23e259){const _0xa3c713=a4_0x197750,_0x1a194b=getChildAgentManager(_0x14f746),{sessionId:_0x50c2c7,target:_0x248f90,instruction:_0x3db65c,context:_0x3717be,workspacePath:_0x466366}=_0x23e259,_0x2de46a=getRegistryPath(_0x466366,_0x50c2c7),_0x84cfc5=loadRepoRegistry(_0x2de46a);if(!_0x84cfc5)return{'success':![],'error':'No\x20Polygraph\x20session\x20found\x20with\x20ID:\x20'+_0x50c2c7+_0xa3c713(0x162)};const _0x4c68ab=_0x84cfc5[_0xa3c713(0x1ef)][_0xa3c713(0x153)](_0x4ef767=>_0x4ef767[_0xa3c713(0x1f7)]===_0x248f90||_0x4ef767[_0xa3c713(0x1ab)]===_0x248f90||_0x4ef767[_0xa3c713(0x1ab)]['endsWith']('/'+_0x248f90));if(!_0x4c68ab){const _0x1eb96d=_0x84cfc5[_0xa3c713(0x1ef)][_0xa3c713(0x1d4)](_0x3b973e=>{const _0x3b16a7=_0xa3c713,_0x512456=_0x3b973e[_0x3b16a7(0x1ab)][_0x3b16a7(0x20c)]('/')[_0x3b16a7(0x233)]()??_0x3b973e[_0x3b16a7(0x1ab)];return _0x512456+'\x20('+_0x3b973e['repoFullName']+')';})['join'](',\x20');return{'success':![],'error':'Repository\x20\x22'+_0x248f90+_0xa3c713(0x141)+_0x50c2c7+_0xa3c713(0x170)+_0x1eb96d};}_0x14f746[_0xa3c713(0x239)](_0xa3c713(0x172)+_0x4c68ab['repoFullName']+_0xa3c713(0x206)+_0x4c68ab[_0xa3c713(0x15e)]);const _0x41ba42=await _0x1a194b['executeTask'](_0x4c68ab[_0xa3c713(0x1f7)],_0x4c68ab['localPath'],_0x3db65c,_0x3717be);return _0x41ba42[_0xa3c713(0x16b)]===_0xa3c713(0x15f)?{'success':!![],'output':_0x41ba42[_0xa3c713(0x161)]}:{'success':![],'error':_0xa3c713(0x1a9)+_0x41ba42[_0xa3c713(0x207)]+_0xa3c713(0x237)+_0x41ba42[_0xa3c713(0x161)]};}async function polygraphPushBranch(_0x1522f9,_0x53123f){const _0x54c510=a4_0x197750,_0x2cb72b=await pushPolygraphBranch(_0x1522f9,_0x53123f);if(!_0x2cb72b[_0x54c510(0x148)])return{'success':![],'error':_0x2cb72b['error']};return{'success':!![],'branch':_0x2cb72b[_0x54c510(0x210)]};}async function polygraphCreatePRs(_0x2bc316,_0x30b73d){const _0x4c515f=a4_0x197750,_0x4932d5=[],_0x52172d=getRegistryPath(_0x30b73d[_0x4c515f(0x145)],_0x30b73d[_0x4c515f(0x12a)]),_0x209f75=loadRepoRegistry(_0x52172d);if(!_0x209f75)return{'success':![],'error':_0x4c515f(0x17f)+_0x30b73d[_0x4c515f(0x12a)]};for(const _0x375045 of _0x30b73d[_0x4c515f(0x198)]){const {owner:_0x53428b,repo:_0x10ef41}=_0x375045,_0x2fa776=_0x209f75[_0x4c515f(0x1ef)][_0x4c515f(0x153)](_0x4b64ca=>_0x4b64ca[_0x4c515f(0x1ab)]===_0x53428b+'/'+_0x10ef41);if(!_0x2fa776){_0x4932d5[_0x4c515f(0x235)]({'owner':_0x53428b,'repo':_0x10ef41,'success':![],'error':_0x4c515f(0x1d8)+_0x53428b+'/'+_0x10ef41+_0x4c515f(0x1eb)});continue;}try{const _0x5ae278=await createPolygraphPR(_0x2bc316,{'sessionId':_0x30b73d[_0x4c515f(0x12a)],'nxCloudUrl':_0x30b73d[_0x4c515f(0x14c)],'authHeaders':_0x30b73d[_0x4c515f(0x193)],'title':_0x375045[_0x4c515f(0x1d5)],'body':_0x375045['body'],'headBranch':_0x375045['headBranch'],'baseBranch':_0x375045['baseBranch'],'workspaceId':_0x2fa776[_0x4c515f(0x1f7)]});_0x5ae278[_0x4c515f(0x148)]?_0x4932d5[_0x4c515f(0x235)]({'owner':_0x53428b,'repo':_0x10ef41,'success':!![],'url':_0x5ae278[_0x4c515f(0x12c)],'number':_0x5ae278[_0x4c515f(0x174)],'title':_0x5ae278[_0x4c515f(0x1d5)]}):_0x4932d5[_0x4c515f(0x235)]({'owner':_0x53428b,'repo':_0x10ef41,'success':![],'error':_0x5ae278['error']});}catch(_0x1e136d){const _0x451c4e=_0x1e136d instanceof Error?_0x1e136d[_0x4c515f(0x163)]:String(_0x1e136d);_0x4932d5[_0x4c515f(0x235)]({'owner':_0x53428b,'repo':_0x10ef41,'success':![],'error':_0x451c4e});}}return{'success':!![],'results':_0x4932d5};}async function polygraphGetSession(_0x1af1f7,_0x2991eb){return await getPolygraphSession(_0x1af1f7,_0x2991eb);}function formatCiPipelineExecution(_0x41e064){const _0x17dac7=a4_0x197750,_0x67e758=[];for(const _0x193ae8 of _0x41e064['runGroups']){for(const _0x1b1c58 of _0x193ae8[_0x17dac7(0x218)]){_0x67e758[_0x17dac7(0x235)](..._0x1b1c58[_0x17dac7(0x1b6)]);}}let _0x14da4a;_0x67e758['length']>0x0?_0x14da4a=_0x17dac7(0x177)+_0x41e064[_0x17dac7(0x16b)]+'\x20('+_0x67e758['length']+_0x17dac7(0x1e2)+_0x67e758['join'](',\x20')+')':_0x14da4a=_0x17dac7(0x177)+_0x41e064[_0x17dac7(0x16b)];const _0x16556e=['\x20\x20'+_0x14da4a];for(const _0x21b886 of _0x41e064['runGroups']){if(_0x21b886[_0x17dac7(0x1e1)]){const _0x1d1ae6=_0x21b886[_0x17dac7(0x1e1)][_0x17dac7(0x1d7)]?'\x20('+_0x21b886[_0x17dac7(0x1e1)][_0x17dac7(0x1d7)]+')':'';_0x16556e[_0x17dac7(0x235)](_0x17dac7(0x21b)+_0x21b886[_0x17dac7(0x1e1)][_0x17dac7(0x231)]+_0x1d1ae6),_0x21b886[_0x17dac7(0x1e1)][_0x17dac7(0x13a)]&&_0x16556e[_0x17dac7(0x235)]('\x20\x20AI\x20Fix\x20Link:\x20'+_0x21b886[_0x17dac7(0x1e1)][_0x17dac7(0x13a)]);}}return _0x16556e[_0x17dac7(0x235)]('\x20\x20CIPE:\x20'+_0x41e064['cipeUrl']),_0x16556e[_0x17dac7(0x1fa)]('\x0a');}function formatPrCiStatus(_0x464006,_0x40d6fc){const _0x397df8=a4_0x197750,_0x544cba=_0x40d6fc[_0x464006['id']];if(!_0x544cba||!_0x544cba[_0x397df8(0x11b)])return _0x397df8(0x17c);return formatCiPipelineExecution(_0x544cba[_0x397df8(0x11b)]);}function formatPolygraphSession(_0x4075ff){const _0x144323=a4_0x197750;var _0x925e64;const _0x46d9e3=[];_0x46d9e3[_0x144323(0x235)](_0x144323(0x11a)+_0x4075ff[_0x144323(0x12a)]),_0x46d9e3[_0x144323(0x235)](_0x144323(0x219)+_0x4075ff[_0x144323(0x204)]),_0x46d9e3['push'](_0x144323(0x154)+(_0x4075ff[_0x144323(0x15f)]?_0x144323(0x15f):_0x144323(0x179))),_0x46d9e3[_0x144323(0x235)]('');if(_0x4075ff[_0x144323(0x1e9)][_0x144323(0x23c)]>0x0){_0x46d9e3[_0x144323(0x235)]('Workspaces:');for(const _0x49861f of _0x4075ff[_0x144323(0x1e9)]){const _0x5ab30a=((_0x925e64=_0x49861f[_0x144323(0x196)])==null?void 0x0:_0x925e64[_0x144323(0x223)])??_0x49861f[_0x144323(0x217)],_0xeee93c=_0x49861f[_0x144323(0x226)]?'\x20(initiator)':'';_0x46d9e3[_0x144323(0x235)]('-\x20'+_0x5ab30a+_0xeee93c);}_0x46d9e3['push']('');}if(_0x4075ff[_0x144323(0x22a)][_0x144323(0x23c)]>0x0){_0x46d9e3[_0x144323(0x235)](_0x144323(0x18e));for(const _0x2a4157 of _0x4075ff[_0x144323(0x22a)]){_0x46d9e3['push']('-\x20'+_0x2a4157[_0x144323(0x1d5)]+'\x20['+_0x2a4157['status']+']'),_0x46d9e3[_0x144323(0x235)](_0x144323(0x1e3)+_0x2a4157[_0x144323(0x210)]),_0x46d9e3[_0x144323(0x235)](_0x144323(0x227)+_0x2a4157['url']),_0x46d9e3[_0x144323(0x235)](formatPrCiStatus(_0x2a4157,_0x4075ff[_0x144323(0x203)]??{}));}_0x46d9e3[_0x144323(0x235)]('');}if(_0x4075ff['dependencyGraph'][_0x144323(0x167)]['length']>0x0||_0x4075ff[_0x144323(0x1fb)][_0x144323(0x1f3)][_0x144323(0x23c)]>0x0){_0x46d9e3[_0x144323(0x235)](_0x144323(0x1b8)),_0x46d9e3['push']('\x20\x20Nodes:\x20'+_0x4075ff[_0x144323(0x1fb)][_0x144323(0x167)]['join'](',\x20'));for(const _0xc9c05a of _0x4075ff[_0x144323(0x1fb)][_0x144323(0x1f3)]){_0x46d9e3[_0x144323(0x235)]('\x20\x20'+_0xc9c05a[_0x144323(0x23e)]+_0x144323(0x18b)+_0xc9c05a[_0x144323(0x146)]);}}return _0x46d9e3[_0x144323(0x1fa)]('\x0a');}async function polygraphMarkReady(_0x5b97d8,_0x6699f4){return await markPolygraphPRsReady(_0x5b97d8,_0x6699f4);}0x0&&(module['exports']={'formatPolygraphSession':formatPolygraphSession,'polygraphCreatePRs':polygraphCreatePRs,'polygraphDelegate':polygraphDelegate,'polygraphGetSession':polygraphGetSession,'polygraphInit':polygraphInit,'polygraphMarkReady':polygraphMarkReady,'polygraphPushBranch':polygraphPushBranch});